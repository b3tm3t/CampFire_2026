<!DOCTYPE html>
<html>
<head>
    <title>Worm Game 3 GUI</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #eef2f3; margin: 0; overflow: hidden;}
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1); text-align: center; position: absolute; z-index: 10;}
        button { padding: 10px 20px; cursor: pointer; background: #2ecc71; color: white; border: none; border-radius: 5px; font-size: 1.1rem;}
        button:hover {background: #27ae60}
        canvas { background:#222; display: none; position: absolute; top: 0; left: 0;}
    </style>
</head>
<body>
    
    <div class="card">
        <h1 id="message">Worm Game 3</h1>
        <button id="startBtn">Start Game</button>
    </div>
    <canvas id="gameCanvas"></canvas>
    
    <script type="module">
        // 1. IMPORT: This pulls the code from your other file
        import {Player} from './Player.js';
        import {Map} from './Map.js';
        
        const myButton = document.getElementById('startBtn');
        const myTitle = document.getElementById('message');
        const mainCanvas = document.getElementById('gameCanvas');
        const ctx = mainCanvas.getContext('2d');
        const keys = {};
        
        // 1. WORLD SETTINGS
        const worldWidth = 3200;
        const worldHeight = 1800;
        const zoom = 2; 
        
        // 2. LOAD BACKGROUND
        const backgroundImage = new Image();
        
        // 3. CREATE PLAYER & BG
        // We use the 5 arguments your class requires: (x, y, speed, width, health)
        const map = new Map(300, 125);

        const worm = new Player(700, 400, 5, 30, 100, map);
        
        backgroundImage.src = "./BackdropWormGame.png";
        
        window.addEventListener('keydown', (e) => keys[e.key] = true);
        window.addEventListener('keyup', (e) => keys[e.key] = false);
        
        function gameLoop() {
            // A. UPDATE
            worm.calculateAngle(keys);
            worm.calculateVelocity(keys);
            
            // Pass the WORLD size, so player stops at 3000, not at the screen edge
            worm.updatePos(worldWidth, worldHeight); 
            
            // B. CAMERA LOGIC
            // Center camera on player
            let camX = worm.pos_x - (mainCanvas.width / 2 / zoom);
            let camY = worm.pos_y - (mainCanvas.height / 2 / zoom);
            
            // Clamp camera to world edges
            camX = Math.max(0, Math.min(camX, worldWidth - (mainCanvas.width / zoom)));
            camY = Math.max(0, Math.min(camY, worldHeight - (mainCanvas.height / zoom)));
            
            // C. DRAW
            ctx.clearRect(0, 0, mainCanvas.width, mainCanvas.height);
            
            ctx.save(); // Start Camera
            
            ctx.scale(zoom, zoom);
            ctx.translate(-camX, -camY);
            
            // Draw Background or Grid
            if (backgroundImage.complete && backgroundImage.naturalWidth !== 0) {
                ctx.drawImage(backgroundImage, 0, 0, worldWidth, worldHeight);
            } else {
                // Draw grid if no image found
                ctx.strokeStyle = "#444";
                ctx.lineWidth = 5;
                ctx.strokeRect(0, 0, worldWidth, worldHeight);
                ctx.lineWidth = 1;
                ctx.beginPath();
                for(let i=0; i<worldWidth; i+=200) { ctx.moveTo(i,0); ctx.lineTo(i, worldHeight); }
                for(let i=0; i<worldHeight; i+=200) { ctx.moveTo(0,i); ctx.lineTo(worldWidth, i); }
                ctx.stroke();
            }
            
            worm.draw(ctx);
            
            ctx.restore(); // End Camera
            
            // D. HUD (Text stays fixed on screen)

            // Debug
            ctx.fillStyle = "white";
            ctx.font = "20px sans-serif";
            ctx.fillText(`Pos: ${Math.floor(worm.pos_x)}, ${Math.floor(worm.pos_y)}`, 20, 40);
            
            requestAnimationFrame(gameLoop);
        }
        
        myButton.addEventListener('click', () => {
            document.querySelector('.card').style.display = 'none';
            
            // Make canvas fill the window
            mainCanvas.width = window.innerWidth;
            mainCanvas.height = window.innerHeight;
            
            // --- TYPO FIXED HERE ---
            mainCanvas.style.display = 'block';
            
            gameLoop();
        });
    </script>
</body>
</html>